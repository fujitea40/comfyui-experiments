# キャラクター立ち絵差分ワークフロー

[このワークフロー](../workflows/CharacterSpriteWorkflow.json)は、qwen-image-editのような高性能なモデルを使わずに、一貫性の高いキャラクターの立ち絵差分を生成するワークフローです。
まだ検証サンプル数は少ないですが、一旦満足いく結果が得られたので公開します。

## ワークフローの概要

1. 衣装LoRAを用いて、目的の衣装の直立画像を生成する
2. IP-Adapterを用いて、直立画像を服装の参照として使用する
3. OpenPose ControlNetを用いて、姿勢を固定化する
4. 上記を組み合わせることで、一貫性の高いキャラクターの立ち絵差分を生成する

![workflow](img/StandingImageWorkflow.png)

ワークフロー上部ではあらかじめ衣装LoRAを用いて、目的の衣装の直立画像を生成しておき、それを読み込みます。
それをSegmentAnythingで衣装検出し、IP-Adapterで参照することで服装を固定化します。

下部のControlNetではOpenPoseを用いて姿勢を固定化します。

顔部分の同一性については、IP-Adapterで参照させないようにすることで、元画像からの影響を受けさせず、作り直しとなります。
ここで、各立ち絵毎にseed値を固定しておくことで、ある程度似た顔画像にすることができます。
但し、これは多少似た画像が生成されやすいものの、おまじないレベルのため、今後顔部分のみIP-Adapterで参照させるなどの方法を追加するかもしれません。

![image](img/StandingImage.png)

